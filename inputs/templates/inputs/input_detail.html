{% extends 'layout.html' %}

{% block title %}Inbox {{input.form.name}}{% endblock %}

{% block body %}

  <div class="row">
    <div class="column small-12 large-10">
      <h1>{{input.form.name}}</h1>
      <small>Created: {{input.created_at|date:"m/d/Y g:i:s"}} by: {{input.user.username}}</small>
      <br/><br/>
    </div>
  </div>

  <div class="row">
    <div class="column large-8 small-12">
      
      <div class="form-content">
	
	<form method="post" action="{% url 'inbox:create' %}" id="input-form" name="{{input.form.id}}">
	  {% autoescape off %}
	    {{input.form.content}}
	  {% endautoescape %}

	  {% if input.status != 'archived' %}
	    <br/><hr/>
	    <button type="button" class="button success" @click="submitForm">Update</button>
	    <a href="{% url 'inbox:delete' pk=input.pk %}" class="button tiny alert float-right">Delete</a>
	  {% endif %}

	  <br/><hr/>

	  <h4>Comments</h4>

	  <table>
	    <thead>
	      <tr>
		<th>Username</th>
		<th>Comment</th>
		<th>Date</th>
	      </tr>
	    </thead>
	    <tbody>
	      {% for comment in input.comment_set.all %}
		<tr>
		  <td>{{comment.user.username}}</td>
		  <td>{{comment.text}}</td>
		  <td>{{comment.created_at|date:"m/d/Y g:i:s"}}</td>
		</tr>
	      {% endfor %}
	    </tbody>
	  </table>
	  
	  {% if input.status != 'archived' %}
	    <textarea name="comment" v-model="comment" placeholder="New comment..."></textarea>
	    <button type="button" class="button small" @click="createComment">Save Comment</button>
	  {% endif %}

	  {% if user == input.route_holder or input.status == 'new' %}
	    <br/><hr/>

	    <h4>Routing</h4>

	    <div class="row">
	      <div class="columns large-4">
		<autocomplete
		  @item-chosen="setUser"
		  @blur="setUser"
		  title="Send Form"
		  :items="users"
		  label="username"
		  class="inline"></autocomplete>
	      </div>

	      <div class="columns large-4">
		<button type="button" class="button small" title="Send" @click="routeForm">&#x27A4;</button>
		<button type="button" class="button small success float-right" title="Archive" @click="archiveForm">&#9745;</button>
	      </div>
	    </div>
	  {% endif %}

	  <br/><hr/>
	  
	  {% if input.status == 'routed' or input.status == 'archived' %}
	    <h4>Appovals</h4>

	    <strong>Current Holder: </strong> {{input.route_holder.username}}
	    <br/><br/>
	    
	    <table>
	      <thead>
		<tr>
		  <th>Username</th>
		  <th>Approval Date</th>
		</tr>
	      </thead>
	      <tbody>
		{% for approval in input.approval_set.all %}
		  <tr>
		    <td>{{approval.user.username}}</td>
		    <td>{{approval.created_at|date:"m/d/Y g:i:s"}}</td>
		  </tr>
		{% endfor %}
	      </tbody>
	    </table>
	  {% endif %}

	</form>
      </div>
      
    </div>
  </div>

{% endblock %}

{% block vue %}
  {% include 'form_vue.html' with data=input.data %}
{% endblock %}
